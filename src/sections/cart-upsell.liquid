{% comment %} this json contains the settings for the cart upsell products {% endcomment %}

{% comment %}
non-minified json:

{
  "header": {{ section.settings.title | json }},
  "products": [
    {% for block in section.blocks %}
      {% assign cart_p = all_products[block.settings.product] %}
      {% assign cart_upsell_1 = all_products[block.settings.product_upsell] %}
      {% assign cart_upsell_2 = all_products[block.settings.product_upsell_2] %}
      {% assign cart_upsell_3 = all_products[block.settings.product_upsell_3] %}
      {
        "active_id": {{ cart_p.id | json }},
        {% if cart_upsell_1 != empty %}
          "upsell_url": {{ cart_upsell_1.url | json }},
          "upsell_product": {{ cart_upsell_1 | json }},
        {% else %}
          "upsell_url": "",
          "upsell_product": "",
        {% endif %}
        {% if cart_upsell_2 != empty %}
          "upsell_url_2": {{ cart_upsell_2.url | json }},
          "upsell_product_2": {{ cart_upsell_2 | json }},
        {% else %}
          "upsell_url_2": "",
          "upsell_product_2": "",
        {% endif %}
        {% if cart_upsell_3 != empty %}
          "upsell_url_3": {{ cart_upsell_3.url | json }},
          "upsell_product_3": {{ cart_upsell_3 | json }}
        {% else %}
          "upsell_url_3": "",
          "upsell_product_3": ""
        {% endif %}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
 {% endcomment %}


<script data-cart-upsell-settings type="application/json">{"header": {{ section.settings.title | json }},"products": [{% for block in section.blocks %}{% assign cart_p = all_products[block.settings.product] %}{% assign cart_upsell_1 = all_products[block.settings.product_upsell] %}{% assign cart_upsell_2 = all_products[block.settings.product_upsell_2] %}{% assign cart_upsell_3 = all_products[block.settings.product_upsell_3] %}{"active_id": {{ cart_p.id | json }},{% if cart_upsell_1 != empty %}"upsell_url": {{ cart_upsell_1.url | json }},"upsell_product": {{ cart_upsell_1 | json }},{% else %}"upsell_url": "","upsell_product": "",{% endif %}{% if cart_upsell_2 != empty %}"upsell_url_2": {{ cart_upsell_2.url | json }},"upsell_product_2": {{ cart_upsell_2 | json }},{% else %}"upsell_url_2": "","upsell_product_2": "",{% endif %}{% if cart_upsell_3 != empty %}"upsell_url_3": {{ cart_upsell_3.url | json }},"upsell_product_3": {{ cart_upsell_3 | json }}{% else %}"upsell_url_3": "","upsell_product_3": ""{% endif %}}{% unless forloop.last %},{% endunless %}{% endfor %}]}</script>

{% schema %}
  {
    "name": "Cart Upsell",
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Heading",
        "default": "Add ons"
      }
    ],
    "blocks": [
      {
        "type": "product",
        "name": "Product",
        "settings": [
          {
            "type": "product",
            "id": "product",
            "label": "Product",
            "info": "Set the product for which to set a product upsell"
          },
          {
            "type": "product",
            "id": "product_upsell",
            "label": "Product Upsell",
            "info": "Set the upsell product for the product set above"
          },
          {
            "type": "product",
            "id": "product_upsell_2",
            "label": "Product Upsell 2",
            "info": "Set the second upsell product for the product set above"
          },
          {
            "type": "product",
            "id": "product_upsell_3",
            "label": "Product Upsell3 ",
            "info": "Set the third upsell product for the product set above"
          }
        ]
      }
    ]
  }
{% endschema %}
