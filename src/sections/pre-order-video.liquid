<div class="container-fluid">
  <div class="container">
    <div class="row d-flex align-items-center">
      <div class="col-md-1"></div>
      <div class="col-md-5">
        <div class="po-video__content">
          <h2>{{ section.settings.title }}</h2>
          <div class="po-content_text">{{section.settings.content_area }}</div>
          <button type="button" class="po-video__link" data-po-video-open>
            <span class="po-video__link-text">{{- section.settings.video_link_text -}}</span>
            <span class="po-video__link-icon">{%- render 'icon-play' -%}</span>
          </button>
        </div>
      </div>
      <div class="col-md-5">

        {%- if section.settings.video_loop != blank -%}
          <video
            class="po-video__looped"
            {% if section.settings.autoplay_loop %}autoplay playsinline muted loop{% else %}controls{% endif %}
            width="{{ section.settings.video_width_loop }}"
            height="{{ section.settings.video_height_loop }}">
            <source src="{{- section.settings.video_loop -}}" type="video/webm">
            <source src="{{- section.settings.video_loop -}}" type="video/mp4">
            <source src="{{- section.settings.video_loop -}}" type="video/ogg">
            Your browser does not support the video tag.
          </video>
          {%- elsif section.settings.video_loop_embed != blank -%}
          <div class="index-video__looped">
            {{- section.settings.video_loop_embed -}}
          </div>
        {%- endif -%}
      </div>
       <div class="col-md-1"></div>
      <button type="button" class="po-video__link po-video__link-responsive d-block d-sm-none" data-po-video-open>
        <span class="po-video__link-text">{{- section.settings.video_link_text -}}</span>
        <span class="po-video__link-icon">{%- render 'icon-play' -%}</span>
      </button>
    </div>
  </div>
</div>

<div class="po-video__modal-wrap" style="display:none;" data-po-video-modal>
  <div class="po-video__modal-outer" data-po-video-close></div>
  <div class="po-video__modal">
    <button class="po-video__modal-close" data-po-video-close tabindex="-1" data-po-video-focusin>
      {% render 'icon-close' %}
      <span class="visually-hidden">{{ 'general.accessibility.close' | t }}</span>
    </button>
    <div class="po-video__container">
      {%- if section.settings.video != blank -%}
        <video
                class="po-video__video"
                {% if section.settings.autoplay %}playsinline muted loop{% else %}controls{% endif %}
                width="{{ section.settings.video_width }}"
                height="{{ section.settings.video_height }}"
                tabindex="-1">
          <source src="{{- section.settings.video -}}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        {%- elsif section.settings.video_embed != blank -%}
        <div class="po-video__video" id="player">

        </div>
      <script>
      // 1. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 2. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '{{ section.settings.video_height }}',
          width: '{{ section.settings.video_width }}',
          playerVars: {
                    showinfo: 0,
                    autohide: 0,
            		rel: 0,
                    vq: 'hd1080'},
          videoId: '{{- section.settings.video_embed -}}',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // 3. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        //event.target.playVideo();
        //player.start();
      }

      var done = false;
      function onPlayerStateChange(event) {

      }
      function stopVideo() {
        player.stopVideo();
      }
      // play Video
      $('.po-video__link').click(function(){
       //console.log("Clicked");
        player.playVideo();
        //$('.po-video__video iframe').click();
      });
      // stop video
      $('.po-video__modal-close').click(function(){
		stopVideo();
      });
      </script>
      {%- endif -%}
    </div>
    <button
            class="visually-hidden"
            data-po-video-close
            tabindex="-1">
      {{ 'general.accessibility.close' | t }}
    </button>
  </div>
</div>

{% schema %}
  {
  "name": "Pre-Order Video",
  "class": "po-video",
  "settings": [
  {
    "type": "text",
    "id": "title",
    "label": "Title"
  },
   {
    "type": "textarea",
    "id": "content_area",
    "label": "Content",
    "info": "Add a description here. You can include HTML"
  },
  {
    "type": "text",
    "id": "video_link_text",
    "label": "Video Link Text"
  },
  {
    "type": "textarea",
    "id": "video",
    "label": "Video",
    "info": "Upload a video to Shopify files and paste the source url here. Or paste the source url to a video here."
  },
  {
    "type": "checkbox",
    "id": "autoplay",
    "label": "Autoplay video?",
    "info": "Mutes and loops video, hides controls, autoplays when modal is opened.",
    "default": true
  },
  {
    "type": "textarea",
    "id": "video_embed",
    "label": "Video Embed",
    "info": "Or use an embed from youtube, vimeo or similar. Copy/paste the embed code here."
  },
  {
    "type": "range",
    "id": "video_width",
    "label": "Video Width",
    "min": 300,
    "max": 900,
    "step": 10,
    "default": 600
  },
  {
    "type": "range",
    "id": "video_height",
    "label": "Video Height",
    "min": 300,
    "max": 680,
    "step": 10,
    "default": 450
  },
  {
    "type": "header",
    "content": "Looping Video"
  },
  {
    "type": "textarea",
    "id": "video_loop",
    "label": "Loop Video",
    "info": "Upload a video to Shopify files and paste the source url here. Or paste the source url to a video here."
  },
  {
    "type": "textarea",
    "id": "video_loop_embed",
    "label": "Loop Video Embed",
    "info": "Or use an embed from youtube, vimeo or similar. Copy/paste the embed code here."
  },
  {
    "type": "checkbox",
    "id": "autoplay_loop",
    "label": "Autoplay video?",
    "info": "Mutes and loops video, hides controls, autoplays when modal is opened.",
    "default": true
  },
  {
    "type": "range",
    "id": "video_width_loop",
    "label": "Video Width",
    "min": 300,
    "max": 900,
    "step": 10,
    "default": 600
  },
  {
    "type": "range",
    "id": "video_height_loop",
    "label": "Video Height",
    "min": 300,
    "max": 680,
    "step": 10,
    "default": 450
  }
  ]
  }
{% endschema %}

